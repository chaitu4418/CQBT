class 'XP4FD_CQBTServer'

local sectorTable = {}
local flagsGuidTable = {};
local flagsPointsTable = {};

function XP4FD_CQBTServer:__init()
    print('Hello world!')
    self:loadSectorTable()
    self:loadFlagsGuidTable()
    self:loadFlagsPointsTable()
    self:registerVars()
    self:registerEvents()
end

function XP4FD_CQBTServer:registerVars()

end

function XP4FD_CQBTServer:registerEvents()
    Events:Subscribe('Level:Loaded', self, self.onLevelLoaded)
end

function XP4FD_CQBTServer:onLevelLoaded()
    self.changeUSAttackSector1Map()

end

function XP4FD_CQBTServer:changeUSAttackSector1Map()
    print('Changing area for US ATTACK Sector 1')

    local cqLogicPartitionGuid = Guid('84DBB672-878F-4892-92A9-57E86F60793D')
    local usSector1VectorData = ResourceManager:RegisterInstanceLoadHandler(cqLogicPartitionGuid, Guid('A53002A3-0C7B-4C1B-B7EB-7A108FA5709F'), function(instance)
        instance = VolumeVectorShapeData(instance)
        instance:MakeWritable()
        instance.points:clear()

        for _,point in pairs(sectorTable['US_Attack_Sector_1_Map_Points']) do
            instance.points:add(point)
        end
    end)
end

function XP4FD_CQBTServer:loadSectorTable()
    sectorTable['US_Attack_Sector_1_Map_Points'] = { Vec3(427.286469, 42.002495, -102.971237),
                                                     Vec3(414.171326, 42.002495, -189.901428),
                                                     Vec3(408.616119, 42.002495, -206.271942),
                                                     Vec3(392.177338, 42.002495, -252.215607),
                                                     Vec3(369.830536, 42.002495, -251.266434),
                                                     Vec3(334.600494, 42.002495, -250.258713),
                                                     Vec3(156.519394, 42.002495, -254.829178),
                                                     Vec3(130.192444, 42.002495, -313.754150),
                                                     Vec3(-32.476807, 65.467911, -353.941132),
                                                     Vec3(-62.535995, 63.372246, -335.062500),
                                                     Vec3(-28.960644, 64.063477, -248.312469),
                                                     Vec3(-22.475033, 64.000977, -240.589340),
                                                     Vec3(-19.491886, 64.000984, -234.647644),
                                                     Vec3(-13.536644, 64.000984, -227.271286),
                                                     Vec3(-2.241532, 64.000977, -207.865295),
                                                     Vec3(16.904392, 64.819115, -174.122787),
                                                     Vec3(36.279083, 64.196716, -129.638885),
                                                     Vec3(41.039825, 63.940964, -116.580391),
                                                     Vec3(71.617249, 65.832420, -101.428841),
                                                     Vec3(77.899734, 65.832428, -98.950554),
                                                     Vec3(100.515511, 64.065170, -87.461517),
                                                     Vec3(132.924103, 64.063118, -86.591469),
                                                     Vec3(161.455185, 64.104774, -86.133553),
                                                     Vec3(182.906616, 64.082588, -95.045052),
                                                     Vec3(197.524765, 64.516701, -107.629013),
                                                     Vec3(198.220016, 64.605522, -126.169937),
                                                     Vec3(198.135498, 64.529488, -129.508698),
                                                     Vec3(229.817078, 42.002495, -110.515923),
                                                     Vec3(253.427078, 42.002495, -129.628006),
                                                     Vec3(296.137817, 42.002495, -133.904755),
                                                     Vec3(331.153137, 42.002495, -97.705467),
                                                     Vec3(369.788849, 42.002495, -92.696526) }
end

function XP4FD_CQBTServer:loadFlagsGuidTable()
    flagsGuidTable['FlagA'] ={'365A9EF3-68A6-4543-9C27-C47D1C48387B'}
    flagsGuidTable['FlagB'] ={'7EAD081E-4EBC-455D-8671-289B3F141C02'}
    flagsGuidTable['FlagC'] ={'769AA6C8-0F4A-400B-B632-24087AB140F8'}
    flagsGuidTable['FlagD'] ={'0A449947-D599-4778-99C0-F3782607283F'}
    flagsGuidTable['FlagE'] ={'E2E49A54-CED1-4F43-9260-D4221D516983'}
end

function XP4FD_CQBTServer:loadFlagsPointsTable()
    flagsPointsTable['FlagA'] ={ Vec3(113.901428, 60.225727, -154.728104),
                               Vec3(125.521393, 60.225727, -154.731262),
                               Vec3(129.673553, 60.225727, -156.480911),
                               Vec3(136.614212, 60.225727, -156.535583),
                               Vec3(137.821167, 60.225727, -160.036697),
                               Vec3(145.577209, 60.225727, -160.027191),
                               Vec3(145.791687, 60.225727, -161.844421),
                               Vec3(145.380798, 60.225727, -173.089127),
                               Vec3(145.507339, 60.225727, -182.710083),
                               Vec3(144.781982, 60.225727, -185.088043),
                               Vec3(139.928741, 60.225727, -186.860489),
                               Vec3(119.839928, 60.225727, -186.866608),
                               Vec3(109.928299, 60.225727, -183.604965),
                               Vec3(108.292725, 60.225727, -179.391663),
                               Vec3(106.709343, 60.225727, -170.476227),
                               Vec3(106.901306, 60.225727, -158.256454)}

    flagsPointsTable['FlagB'] ={ Vec3(79.974220, 59.877678, -71.333466),
                               Vec3(79.632950, 59.877678, -64.425537),
                               Vec3(79.980820, 59.877678, -54.470436),
                               Vec3(80.440170, 59.877678, -44.276520),
                               Vec3(102.587868, 59.877678, -47.265522),
                               Vec3(120.030838, 59.877678, -41.561367),
                               Vec3(129.649033, 59.877678, -41.368591),
                               Vec3(129.437454, 59.877678, -46.314278),
                               Vec3(127.866425, 59.877678, -50.516983),
                               Vec3(127.912048, 59.877678, -53.994785),
                               Vec3(129.590912, 59.877678, -65.534737),
                               Vec3(130.065796, 59.877678, -77.376259),
                               Vec3(117.033257, 59.877678, -77.651688),
                               Vec3(109.577744, 59.877678, -73.464027),
                               Vec3(101.640915, 59.877678, -71.879654)}

    flagsPointsTable['FlagC'] ={ Vec3(36.296890, 61.005089, -234.683594),
                               Vec3(34.070740, 61.005089, -238.252655),
                               Vec3(32.253036, 61.005089, -241.999466),
                               Vec3(29.233854, 61.005089, -244.167130),
                               Vec3(27.207676, 61.005089, -252.168762),
                               Vec3(14.273496, 61.005089, -249.714203),
                               Vec3(5.124260, 61.005089, -243.567673),
                               Vec3(-8.854609, 61.005089, -235.903702),
                               Vec3(-25.660156, 61.005089, -226.605255),
                               Vec3(-18.759130, 61.005089, -213.268402),
                               Vec3(-16.795105, 61.005089, -214.286865),
                               Vec3(-13.312475, 61.005089, -207.670761),
                               Vec3(-9.985201, 61.005089, -201.508682),
                               Vec3(-0.146107, 61.005089, -206.592285),
                               Vec3(9.952809, 61.005089, -211.753769),
                               Vec3(24.599571, 61.005089, -218.430038),
                               Vec3(22.122185, 61.005089, -225.991180),
                               Vec3(31.646927, 61.005089, -230.761429)}

    flagsPointsTable['FlagD'] ={ Vec3(-16.040091, 61.383087, -94.001808),
                               Vec3(-16.049301, 61.383087, -114.662117),
                               Vec3(-52.120983, 61.383087, -114.752014),
                               Vec3(-52.080742, 61.383087, -108.280396),
                               Vec3(-52.108818, 61.383087, -98.363579),
                               Vec3(-50.041862, 61.383087, -98.366287),
                               Vec3(-49.882320, 61.383087, -88.566467),
                               Vec3(-39.654011, 61.383087, -88.631470),
                               Vec3(-33.881859, 61.383087, -88.570282),
                               Vec3(-21.268267, 61.383087, -88.634323),
                               Vec3(-21.342552, 61.383087, -94.026695)}

    flagsPointsTable['FlagE'] ={ Vec3(-41.345013, 67.924667, 22.741705),
                               Vec3(-40.568882, 67.924667, 32.882050),
                               Vec3(-36.380898, 67.924667, 32.679550),
                               Vec3(-28.488907, 67.924667, 32.493160),
                               Vec3(-28.492367, 67.924667, 35.995968),
                               Vec3(-23.360750, 67.924667, 35.928162),
                               Vec3(-22.973600, 67.924667, 32.664703),
                               Vec3(-17.337105, 67.924667, 32.804424),
                               Vec3(-11.697602, 67.924667, 32.674683),
                               Vec3(-11.652452, 67.924667, 5.594952),
                               Vec3(-12.151768, 67.924667, -4.186542),
                               Vec3(-17.188604, 67.924667, -4.018291),
                               Vec3(-18.997055, 67.924667, -4.010616),
                               Vec3(-40.316944, 67.924667, -4.773425),
                               Vec3(-41.572567, 67.924667, -4.717351),
                               Vec3(-41.457890, 67.924667, 4.335397),
                               Vec3(-41.896423, 67.924667, 4.402654),
                               Vec3(-42.825077, 67.924667, 8.735227),
                               Vec3(-42.780396, 67.924667, 9.452746),
                               Vec3(-46.190765, 67.924667, 9.470108),
                               Vec3(-46.164814, 67.924667, 13.661378),
                               Vec3(-42.723141, 67.924667, 14.269883),
                               Vec3(-41.414364, 67.924667, 14.261637),
                               Vec3(-41.277821, 67.924667, 19.319839)}
end

g_XP4FD_CQBTServer = XP4FD_CQBTServer();